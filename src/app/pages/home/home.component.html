<!-- Live View -->
<div *ngIf="currentView === 'live'" id="liveView" class="flex flex-col h-screen justify-between p-4 md:p-6 fade-in">
  <!-- Header -->
  <header class="flex justify-between items-center">
    <h1 class="text-xl font-semibold">Live</h1>
    <button id="closeBtn" (click)="closeLiveMode()" class="icon-btn rounded-full p-2 focus:outline-none focus:ring-2 focus:ring-white">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
  </header>

  <!-- Listening Indicator -->
  <div id="listening-indicator" class="text-center">
    <p class="text-lg mb-8 opacity-80">{{ isListening ? 'Listening...' : 'Paused' }}</p>
  </div>

  <!-- Footer Controls -->
  <footer class="flex justify-around items-center p-4">
    <button id="cameraBtn" (click)="startCamera()" class="icon-btn rounded-full p-4 transition-transform duration-200 ease-in-out hover:scale-110">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
      </svg>
    </button>
    <button id="micBtn" (click)="toggleListen()"
            class="rounded-full p-6 transition-transform duration-200 ease-in-out hover:scale-110 focus:outline-none focus:ring-4 focus:ring-white focus:ring-opacity-50"
            [class.bg-white]="isListening" [class.text-blue-600]="isListening"
            [class.bg-red-500]="!isListening" [class.text-white]="!isListening"
            [class.pulsing-glow]="isListening">
      <svg *ngIf="isListening" id="micIcon" xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm5 4a1 1 0 11-2 0V4a1 1 0 112 0v4zM3 9a1 1 0 011-1h1.172a4 4 0 013.998 4.223l.135.811a4.002 4.002 0 01-3.182 3.965A4.002 4.002 0 014.172 15H4a1 1 0 110-2h.172a2 2 0 001.995-2.223l-.135-.81a2 2 0 00-1.995-1.744H4a1 1 0 01-1-1zm12.172 2.223a4 4 0 01-3.998-4.223H15a1 1 0 110 2h-.172a2 2 0 00-1.995 2.223l.135.81a2 2 0 001.995 1.744H16a1 1 0 110 2h-.828a4.002 4.002 0 01-3.998-3.777l-.135-.811A4 4 0 0111.828 9H13a1 1 0 110 2h-.172z" clip-rule="evenodd" />
      </svg>
      <svg *ngIf="!isListening" id="pauseIcon" xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
      </svg>
    </button>
    <button id="addFileBtn" (click)="triggerFileInputClick()" class="icon-btn rounded-full p-4 transition-transform duration-200 ease-in-out hover:scale-110">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
      </svg>
    </button>
  </footer>
</div>

<!-- Camera View -->
<div *ngIf="currentView === 'camera'" id="cameraView" class="flex flex-col h-screen p-4 md:p-6 fade-in bg-black bg-opacity-50">
  <!-- Header -->
  <header class="flex justify-between items-center text-white mb-4">
    <button id="backBtn" (click)="stopCamera()" class="icon-btn rounded-full p-2 focus:outline-none focus:ring-2 focus:ring-white">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
      </svg>
    </button>
    <h1 class="text-xl font-semibold">Vision</h1>
    <div class="w-6"></div> <!-- Spacer for alignment -->
  </header>

  <!-- Main Content Area (Video/Image/Response) -->
  <main class="relative flex-grow flex items-center justify-center bg-black rounded-lg overflow-hidden shadow-xl mb-4">
    <video #videoFeed *ngIf="showVideoFeed" id="videoFeed" class="w-full h-full object-cover" autoplay playsinline></video>
    <img #capturedImage *ngIf="showCapturedImage" id="capturedImage" class="w-full h-full object-contain"/>

    <div *ngIf="geminiResponseText" id="geminiResponse" class="absolute inset-0 p-4 bg-black bg-opacity-60 overflow-y-auto no-scrollbar text-lg leading-relaxed flex items-center justify-center text-white">
      <p>{{ geminiResponseText }}</p>
    </div>

    <div *ngIf="isLoadingGemini" id="loadingIndicator" class="absolute inset-0 bg-black bg-opacity-70 flex items-center justify-center">
      <div class="w-16 h-16 border-4 border-dashed rounded-full animate-spin border-white"></div>
    </div>
  </main>

  <!-- Prompt Input Area -->
  <div *ngIf="showPromptArea" class="flex items-center space-x-2 mb-4">
    <input #promptInputElem id="promptInput" type="text" [(ngModel)]="promptInputValue" (keyup.enter)="callGeminiAPI()" class="flex-grow bg-white/20 border border-white/30 rounded-full py-3 px-5 focus:outline-none focus:ring-2 focus:ring-white placeholder-white/70 text-white" placeholder="Ask a question about the image...">
    <button id="sendPromptBtn" (click)="callGeminiAPI()" class="bg-white text-blue-600 rounded-full p-3 focus:outline-none hover:bg-gray-200">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
      </svg>
    </button>
  </div>

  <!-- Footer Controls (Capture Button) -->
  <footer class="flex justify-center items-center h-24">
    <button *ngIf="showCaptureButton" id="captureBtn" (click)="captureFrame()" class="bg-white text-red-600 w-20 h-20 rounded-full border-4 border-black/20 focus:outline-none focus:ring-4 focus:ring-white/50 flex items-center justify-center">
      <div class="w-16 h-16 bg-white rounded-full"></div> <!-- Inner circle for visual -->
    </button>
  </footer>
</div>

<!-- Hidden elements -->
<canvas id="canvas" #canvas class="hidden"></canvas>
<input type="file" id="fileInput" #fileInput class="hidden" accept="image/*" (change)="handleFileUpload($event)">

<!-- Message Box -->
<div *ngIf="isMessageBoxVisible" id="message-box"
     class="fixed bottom-24 left-1/2 -translate-x-1/2 bg-gray-800 text-white text-center py-2 px-4 rounded-lg shadow-lg transition-opacity duration-300 z-50"
     [class.opacity-0]="!isMessageBoxVisible">
  {{ messageBoxText }}
</div>
